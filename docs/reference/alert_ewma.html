<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Exponentially Weighted Moving Average (EWMA) — alert_ewma • Rnssp</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Exponentially Weighted Moving Average (EWMA) — alert_ewma" />
<meta property="og:description" content="The EWMA compares a weighted average of the most recent visit counts
to a baseline expectation. For the weighted average to be tested, an exponential
weighting gives the most influence to the most recent observations.
This algorithm is appropriate for daily counts that do not have the
characteristic features modeled in the regression algorithm. It is more applicable
for Emergency Department data from certain hospital groups and for time series with
small counts (daily average below 10) because of the limited case definition or
chosen geographic region." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rnssp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Rnssp_intro.html">Introduction to the Rnssp package</a>
    </li>
    <li>
      <a href="../articles/Rnssp_text_mining.html">Text Mining Example</a>
    </li>
    <li>
      <a href="../articles/Rnssp_trend_alert_detection.html">Anomaly Detection and Trend Classification</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Exponentially Weighted Moving Average (EWMA)</h1>
    
    <div class="hidden name"><code>alert_ewma.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The EWMA compares a weighted average of the most recent visit counts
to a baseline expectation. For the weighted average to be tested, an exponential
weighting gives the most influence to the most recent observations.
This algorithm is appropriate for daily counts that do not have the
characteristic features modeled in the regression algorithm. It is more applicable
for Emergency Department data from certain hospital groups and for time series with
small counts (daily average below 10) because of the limited case definition or
chosen geographic region.</p>
    </div>

    <pre class="usage"><span class='fu'>alert_ewma</span><span class='op'>(</span><span class='va'>df</span>, t <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>count</span>, B <span class='op'>=</span> <span class='fl'>28</span>, g <span class='op'>=</span> <span class='fl'>2</span>, w <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df</th>
      <td><p>A data frame, data frame extension (e.g. a tibble), or a lazy data frame.</p></td>
    </tr>
    <tr>
      <th>t</th>
      <td><p>Name of the column of type Date containing the dates</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Name of the column of type Numeric containing counts or percentages</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>Baseline parameter. The baseline length is the number of days from which to
compute the EWMA and compare to in order to form the test statistic (default is 28)</p></td>
    </tr>
    <tr>
      <th>g</th>
      <td><p>Guardband paramter. The guardband length is the number of days separating
the baseline from the current date in consideration for alerting (default is 2)</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>Smoothing parameter. The smoothing parameter controls the amount of
smoothing in the exponentially weighted moving average (default is 0.4)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Example 1</span>
<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.Date.html'>seq.Date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2020-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2020-12-31"</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
                 count <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>366</span>, min<span class='op'>=</span><span class='fl'>0</span>, max<span class='op'>=</span><span class='fl'>101</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>df_ewma</span> <span class='op'>&lt;-</span> <span class='fu'>alert_ewma</span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>
</div><div class='output co'>#&gt;         date count
#&gt; 1 2020-01-01     8
#&gt; 2 2020-01-02    84
#&gt; 3 2020-01-03    60
#&gt; 4 2020-01-04    15
#&gt; 5 2020-01-05     0
#&gt; 6 2020-01-06    47</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>df_ewma</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          date count          t  y       mu        s        z test_statistic
#&gt; 1: 2020-01-31     3 2020-01-31  3 44.57143 30.81057 38.08712   -0.383510999
#&gt; 2: 2020-02-01    22 2020-02-01 22 46.78571 30.30873 31.65227   -0.909879234
#&gt; 3: 2020-02-02    30 2020-02-02 30 46.25000 29.75408 30.99136   -0.934507694
#&gt; 4: 2020-02-03    64 2020-02-03 64 44.21429 30.71296 44.19482   -0.001155092
#&gt; 5: 2020-02-04    48 2020-02-04 48 44.46429 30.49406 45.71689    0.074853581
#&gt; 6: 2020-02-05    43 2020-02-05 43 45.53571 29.38062 44.63013   -0.056166784
#&gt;      p.value alert
#&gt; 1: 0.3521721  blue
#&gt; 2: 0.1854688  blue
#&gt; 3: 0.1791626  blue
#&gt; 4: 0.4995434  blue
#&gt; 5: 0.4704415  blue
#&gt; 6: 0.4778113  blue</div><div class='input'>
<span class='co'># Example 2</span>
<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>Date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.Date.html'>seq.Date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2020-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='st'>"2020-12-31"</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
                 percent <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>366</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>df_ewma</span> <span class='op'>&lt;-</span> <span class='fu'>alert_ewma</span><span class='op'>(</span><span class='va'>df</span>, t <span class='op'>=</span> <span class='va'>Date</span>, y <span class='op'>=</span> <span class='va'>percent</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>
</div><div class='output co'>#&gt;         Date    percent
#&gt; 1 2020-01-01 0.93648743
#&gt; 2 2020-01-02 0.97068136
#&gt; 3 2020-01-03 0.71027405
#&gt; 4 2020-01-04 0.88509093
#&gt; 5 2020-01-05 0.97687532
#&gt; 6 2020-01-06 0.03489964</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>df_ewma</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          Date    percent          t          y        mu   s         z
#&gt; 1: 2020-01-31 0.89274570 2020-01-31 0.89274570 0.6138711 0.5 0.7007241
#&gt; 2: 2020-02-01 0.84387029 2020-02-01 0.84387029 0.6115889 0.5 0.7579826
#&gt; 3: 2020-02-02 0.72976121 2020-02-02 0.72976121 0.5905639 0.5 0.7466940
#&gt; 4: 2020-02-03 0.03841498 2020-02-03 0.03841498 0.5970808 0.5 0.4633824
#&gt; 5: 2020-02-04 0.33382332 2020-02-04 0.33382332 0.5956086 0.5 0.4115588
#&gt; 6: 2020-02-05 0.74927265 2020-02-05 0.74927265 0.5867831 0.5 0.5466443
#&gt;    test_statistic   p.value alert
#&gt; 1:      0.3165399 0.3770136  blue
#&gt; 2:      0.5335386 0.2990130  blue
#&gt; 3:      0.5690236 0.2870218  blue
#&gt; 4:     -0.4872702 0.3149998  blue
#&gt; 5:     -0.6707786 0.2540298  blue
#&gt; 6:     -0.1462878 0.4423905  blue</div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Example 3: Data from NSSP-ESSENCE</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>

<span class='va'>myProfile</span> <span class='op'>&lt;-</span> <span class='va'><a href='Credentials.html'>Credentials</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='fu'><a href='askme.html'>askme</a></span><span class='op'>(</span><span class='st'>"Enter your username:"</span><span class='op'>)</span>, <span class='fu'><a href='askme.html'>askme</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>url</span> <span class='op'>&lt;-</span> <span class='st'>"https://essence2.syndromicsurveillance.org/nssp_essence/api/timeSeries?endDate=20Nov20
&amp;percentParam=ccddCategory&amp;datasource=va_hosp&amp;startDate=22Aug20&amp;medicalGroupingSystem=essencesyndromes
&amp;userId=2362&amp;aqtTarget=TimeSeries&amp;ccddCategory=cli%20cc%20with%20cli%20dd%20and%20coronavirus%20dd%20v2
&amp;geographySystem=hospitalstate&amp;detector=probregv2&amp;timeResolution=daily&amp;hasBeenE=1&amp;stratVal=
&amp;multiStratVal=geography&amp;graphOnly=true&amp;numSeries=0&amp;graphOptions=multipleSmall&amp;seriesPerYear=false
&amp;nonZeroComposite=false&amp;removeZeroSeries=true&amp;sigDigits=true&amp;startMonth=January&amp;stratVal=&amp;multiStratVal=geography
&amp;graphOnly=true&amp;numSeries=0&amp;graphOptions=multipleSmall&amp;seriesPerYear=false&amp;startMonth=January&amp;nonZeroComposite=false"</span>

<span class='va'>url</span> <span class='op'>&lt;-</span> <span class='va'>url</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"\n"</span>, <span class='st'>""</span>, <span class='va'>.</span><span class='op'>)</span>

<span class='va'>api_data</span> <span class='op'>&lt;-</span> <span class='va'>myProfile</span><span class='op'>$</span><span class='fu'>get_api_data</span><span class='op'>(</span><span class='va'>url</span><span class='op'>)</span>

<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='va'>api_data</span><span class='op'>$</span><span class='va'>timeSeriesData</span>

<span class='va'>df_ewma</span> <span class='op'>&lt;-</span> <span class='fu'>alert_ewma</span><span class='op'>(</span><span class='va'>df</span>, t <span class='op'>=</span> <span class='va'>date</span>, y <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span>

<span class='co'># Visualize alert for South Dakota</span>
<span class='va'>df_ewma_state</span> <span class='op'>&lt;-</span> <span class='va'>df_ewma</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>hospitalstate_display</span> <span class='op'>==</span> <span class='st'>"South Dakota"</span><span class='op'>)</span>

<span class='va'>df_ewma_state</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>t</span>, y <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"blue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>df_ewma_state</span>, <span class='va'>alert</span> <span class='op'>==</span> <span class='st'>"red"</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>df_ewma_state</span>, <span class='va'>alert</span> <span class='op'>==</span> <span class='st'>"yellow"</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"yellow"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Date"</span>,
       y <span class='op'>=</span> <span class='st'>"Percent"</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Gbedegnon Roseric Azondekon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


